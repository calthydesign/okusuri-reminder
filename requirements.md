
---

# 💊 おくすりリマインダー 要件定義
## 目的

ユーザーが服薬を忘れないように、**LINE 通知を中心にしたリマインド＋記録**を行うアプリ。

---

## 機能要件（補足・追加）

1. **ユーザー管理**

   * LINE アカウント ID でユーザーを識別
   * 複数ユーザー（家族）対応はフェーズ 3 以降

2. **服薬スケジュール登録**

   * 必須項目：薬名、1日の服薬回数、服薬時間（複数可）、開始日、日数／終了日
   * オプション項目：服薬方法（食前・食後など）、メモ
   * 入力バリデーション：時間形式、日数の範囲、重複チェック

3. **リマインド通知**

   * 登録された時刻に **LINE push API** で通知
   * 通知には「飲んだ」「あとで」ボタン付き
   * 「あとで」を選んだ場合、◯分後に再通知（スヌーズ機能）

4. **服薬記録管理**

   * 「飲んだ」操作で DB に記録（薬ID・日時・ユーザーID）
   * 当日・前日の服薬履歴を LINE で確認可能
   * 飲み忘れ（指定時間から◯時間経過しても「飲んだ」がない場合）を判定

5. **薬情報の編集・削除**

   * 登録済みスケジュールの変更／削除が可能
   * 削除時には履歴は保持する（監査ログとして）

---

## 非機能要件（補足）

* **通知精度**：LINE push の遅延がないよう、cron + バックエンド（Python, Flask/FastAPI）でジョブ管理
* **データベース設計**

  * MySQL に以下のテーブルを設置：

    * users（ユーザー情報）
    * medicines（薬情報）
    * schedules（服薬スケジュール）
    * intake\_logs（服薬記録）
  * 外部キーでユーザーと薬情報を紐づけ
* **セキュリティ**

  * LINE アカウントによる認証
  * HTTPS 通信必須（本番環境）
* **開発環境**

  * ローカルで SQLite、デプロイ時に MySQL（さくらサーバー）へ移行

---

## UI / UX 要件（補足）

* LINE Bot をメイン UI とし、以下の操作を提供：

  * 薬登録：入力ガイド（「薬名は？」「時間は？」と順番に聞く形式）
  * クイックリプライやボタン選択で誤入力防止
* 登録内容確認：登録後に「これでよろしいですか？」確認を必ず表示
* 通知文言：わかりやすく、シンプル（「アレグラの時間です。飲みましたか？」）

---

## システム構成（追記）

* **バックエンド**：Python（Flask or FastAPI）
* **DB**：MySQL（ローカルは SQLite）
* **ジョブ管理**：cron or APScheduler
* **外部連携**：LINE Messaging API（通知・ボタン応答）

---

## 開発フェーズでのタスク（整理）

* [ ] DB スキーマ設計（users, medicines, schedules, intake\_logs）
* [ ] LINE Bot ハンドラー実装
* [ ] 薬登録フロー（順番に聞いて DB 登録）
* [ ] 通知ジョブ（APScheduler）
* [ ] 「飲んだ」応答 → intake\_logs に保存
* [ ] 当日・前日の履歴表示
* [ ] 編集・削除フロー

---
